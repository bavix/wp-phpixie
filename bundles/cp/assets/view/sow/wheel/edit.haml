- $this->layout('cp:layout')

.col-lg-9

  .ibox
    .ibox-title
      %h3
        Edit Wheel
        %label.label.label-info.pull-right
          = $_($wheel->name)
    .ibox-content

      .tabs-container
        .tabs-right
          %ul.nav.nav-tabs
            %li.active
              %a(data-toggle="tab" href="#tab-base") Base
            %li
              %a(data-toggle="tab" href="#tab-image") Image
            %li
              %a(data-toggle="tab" href="#tab-video") Video
            -#- if ($user->hasPermission('cp.log'))
              %li
                %a(data-toggle="tab" href="#tab-last-activity")
                  %label.label.label-info.pull-right = $logCount
                  Last activity

          .tab-content

            #tab-base.tab-pane.active
              .panel-body
                partial: 'cp:sow/wheel/edit.tabs/base'

            #tab-image.tab-pane
              .panel-body
                partial: 'cp:sow/wheel/edit.tabs/image'

            #tab-video.tab-pane
              .panel-body
                partial: 'cp:sow/wheel/edit.tabs/video'

-# fixme css/js code
<link rel="stylesheet" href="/node_modules/plyr/dist/plyr.css">
<script src="/node_modules/plyr/dist/plyr.js"></script>
-#<script>plyr.setup();</script>

:css

  .upload-link {
    color: #36c;
    display: inline-block;
    *zoom: 1;
    *display: inline;
    overflow: hidden;
    position: relative;
    text-decoration: none;
    /*background-color: #fff;*/
    /*background-color: rgba(255,255,255,.85);*/
    padding: 3px 8px;
  }

  .upload-link__txt {
    z-index: 1;
    position: relative;
    border-bottom: 1px dotted #36c;
  }

  .upload-link:hover .upload-link__txt {
    /*color: #f00;*/
    /*border-bottom-color: #f00;*/
  }

  .upload-link__inp {
    top: -10px;
    right: -40px;
    z-index: 2;
    position: absolute;
    cursor: pointer;
    opacity: 0;
    filter: alpha(opacity=0);
    font-size: 50px;
  }

  .upload {
    width: 220px;
    height: 220px;
    /*border: 2px solid #ccc;*/
    position: relative;
    /*background-color: #fff;*/
  }

  .upload__preview {
    -webkit-transition: opacity .3s ease;
    -moz-transition: opacity .3s ease;
    transition: opacity .3s ease;
  }

  .upload__progress {
    color: #fff;
  }

  .upload__link, .upload__progress {
    bottom: 5%;
    width: 100%;
    position: absolute;
    text-align: center;
  }

  .upload__progress,
  .upload_active .upload__link { display: none; }

  .upload_active .upload__preview { opacity: .75; }
  .upload_active .upload__progress { display: block; }

.col-lg-3(align="center")
  %form.thumbnail.upload{:name => "userpic"}
    %input(type="hidden" name="preview" value="1")
    %input(type="hidden" name="id" value="#{$wheel->id}")
    %input(type="hidden" name="userId" value="#{$user->id}")
    #preview.upload__preview
    .upload__progress Uploading…
    .upload__link
      %a.upload-link.js-fileapi-wrapper
        %span.btn.btn-warning.upload-link__txt Browse
        %input.upload-link__inp{:accept => "image/*", :name => "photo", :type => "file"}

/ Modal
#modalUpload.modal.fade{"aria-labelledby" => "modalLabel", :role => "dialog", :tabindex => "-1"}
  .modal-dialog.modal-lg{:role => "document"}
    .modal-content
      .modal-header
        %h5#modalLabel.modal-title Cropper
        %button.close{"aria-label" => "Close", "data-dismiss" => "modal", :type => "button"}
          %span{"aria-hidden" => "true"} ×
      .modal-body
        .img-container
          %img#modalUploadImg(style="max-width: 550px")
      .modal-footer
        %button.btn.btn-success{"data-dismiss" => "upload", :type => "button"} Upload
        %button.btn.btn-default{"data-dismiss" => "modal", :type => "button"} Close

-# cropperJs
- $assets::pushJs('/node_modules/cropperjs/dist/cropper.min.js')
- $assets::pushCss('/node_modules/cropperjs/dist/cropper.min.css')

- $assets::pushJs('/js/cp/sow/wheel/edit.js')
- $assets::pushJs('/js/cp/upload/image.js')
- $assets::pushJs('/js/cp/upload/image-wheel.js')
- $assets::pushJs('/node_modules/fileapi/dist/FileAPI.min.js')

:javascript

  FileAPI.Image("#{$wheel->thumbsLogo()}")
    .preview($(preview).width(), $(preview).height())
    .get(function (err, image) {
      if (!err) {
        var preview = document.getElementById('preview');
        preview.innerHTML = '';
        preview.appendChild(image);
      }
    });
